<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ActivityTracker Dashboard</title>
    <meta name="description" content="ActivityTracker dashboard for viewing and managing activities tracked via SMS">
    
    <!-- React and ReactDOM from CDN -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel for JSX transformation -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Chart.js for data visualization -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Custom CSS for additional styling -->
    <style>
        /* Custom scrollbar styling */
        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
        }
        
        .custom-scrollbar::-webkit-scrollbar-track {
            background: #f1f5f9;
        }
        
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 3px;
        }
        
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }
        
        /* Activity type colors */
        .activity-work { @apply bg-blue-100 text-blue-800; }
        .activity-exercise { @apply bg-green-100 text-green-800; }
        .activity-meal { @apply bg-yellow-100 text-yellow-800; }
        .activity-study { @apply bg-purple-100 text-purple-800; }
        .activity-social { @apply bg-pink-100 text-pink-800; }
        .activity-travel { @apply bg-indigo-100 text-indigo-800; }
        .activity-other { @apply bg-gray-100 text-gray-800; }
        
        /* Loading animations */
        .loading-spinner {
            border: 3px solid #f3f3f3;
            border-radius: 50%;
            border-top: 3px solid #3498db;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Fade in animation */
        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Root element for React application -->
    <div id="root"></div>
    
    <!-- Configuration script -->
    <script>
        // Application configuration
        window.APP_CONFIG = {
            // API base URL - will be replaced during deployment
            API_BASE_URL: 'https://YOUR_API_GATEWAY_URL/dev',
            
            // Application metadata
            VERSION: '1.0.0',
            ENVIRONMENT: 'dev',
            
            // Default settings
            DEFAULT_DAYS: 30,
            MAX_ACTIVITIES_PER_PAGE: 50,
            REFRESH_INTERVAL: 30000, // 30 seconds
            
            // Activity type configuration
            ACTIVITY_TYPES: {
                work: { label: 'Work', icon: 'üíº', color: 'blue' },
                exercise: { label: 'Exercise', icon: 'üèÉ', color: 'green' },
                meal: { label: 'Meal', icon: 'üçΩÔ∏è', color: 'yellow' },
                study: { label: 'Study', icon: 'üìö', color: 'purple' },
                social: { label: 'Social', icon: 'üë•', color: 'pink' },
                travel: { label: 'Travel', icon: '‚úàÔ∏è', color: 'indigo' },
                other: { label: 'Other', icon: 'üìù', color: 'gray' }
            }
        };
    </script>
    
    <!-- Main React Application -->
    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        
        /**
         * Main Dashboard Component
         * 
         * The root component that manages the overall dashboard state and layout.
         * Handles data fetching, error states, and component coordination.
         */
        function Dashboard() {
            // Application state management
            const [activities, setActivities] = useState([]);
            const [statistics, setStatistics] = useState(null);
            const [loading, setLoading] = useState(true);
            const [error, setError] = useState(null);
            const [selectedPhone, setSelectedPhone] = useState('');
            const [selectedDays, setSelectedDays] = useState(window.APP_CONFIG.DEFAULT_DAYS);
            const [lastRefresh, setLastRefresh] = useState(new Date());
            
            // Refs for cleanup
            const refreshIntervalRef = useRef(null);
            
            /**
             * Fetch activities from the API
             * 
             * Retrieves activities based on current filter settings and updates
             * the component state with the results.
             */
            const fetchActivities = async () => {
                try {
                    const params = new URLSearchParams();
                    if (selectedPhone) params.append('phone', selectedPhone);
                    params.append('days', selectedDays.toString());
                    params.append('limit', window.APP_CONFIG.MAX_ACTIVITIES_PER_PAGE.toString());
                    
                    const response = await fetch(`${window.APP_CONFIG.API_BASE_URL}/activities?${params}`);
                    
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }
                    
                    const data = await response.json();
                    setActivities(data.activities || []);
                    setError(null);
                    
                } catch (err) {
                    console.error('Error fetching activities:', err);
                    setError(`Failed to load activities: ${err.message}`);
                }
            };
            
            /**
             * Fetch statistics from the API
             * 
             * Retrieves activity statistics for the dashboard overview and charts.
             */
            const fetchStatistics = async () => {
                try {
                    const params = new URLSearchParams();
                    if (selectedPhone) params.append('phone', selectedPhone);
                    params.append('days', selectedDays.toString());
                    
                    const response = await fetch(`${window.APP_CONFIG.API_BASE_URL}/stats?${params}`);
                    
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }
                    
                    const data = await response.json();
                    setStatistics(data.statistics || {});
                    
                } catch (err) {
                    console.error('Error fetching statistics:', err);
                    // Don't set error for stats failure, just log it
                }
            };
            
            /**
             * Refresh all data
             * 
             * Refreshes both activities and statistics data from the API.
             */
            const refreshData = async () => {
                setLoading(true);
                await Promise.all([fetchActivities(), fetchStatistics()]);
                setLoading(false);
                setLastRefresh(new Date());
            };
            
            // Initial data load and setup refresh interval
            useEffect(() => {
                refreshData();
                
                // Set up auto-refresh interval
                refreshIntervalRef.current = setInterval(() => {
                    refreshData();
                }, window.APP_CONFIG.REFRESH_INTERVAL);
                
                // Cleanup interval on unmount
                return () => {
                    if (refreshIntervalRef.current) {
                        clearInterval(refreshIntervalRef.current);
                    }
                };
            }, []);
            
            // Refresh data when filters change
            useEffect(() => {
                refreshData();
            }, [selectedPhone, selectedDays]);
            
            /**
             * Handle phone number filter change
             */
            const handlePhoneChange = (phone) => {
                setSelectedPhone(phone);
            };
            
            /**
             * Handle days filter change
             */
            const handleDaysChange = (days) => {
                setSelectedDays(parseInt(days));
            };
            
            return (
                <div className="min-h-screen bg-gray-50">
                    {/* Header */}
                    <header className="bg-white shadow-sm border-b">
                        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                            <div className="flex justify-between items-center py-6">
                                <div className="flex items-center">
                                    <h1 className="text-3xl font-bold text-gray-900">
                                        üì± ActivityTracker
                                    </h1>
                                    <span className="ml-3 text-sm text-gray-500">
                                        v{window.APP_CONFIG.VERSION}
                                    </span>
                                </div>
                                
                                <div className="flex items-center space-x-4">
                                    <span className="text-sm text-gray-500">
                                        Last updated: {lastRefresh.toLocaleTimeString()}
                                    </span>
                                    <button
                                        onClick={refreshData}
                                        disabled={loading}
                                        className="inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50"
                                    >
                                        {loading ? (
                                            <div className="loading-spinner mr-2"></div>
                                        ) : (
                                            <span className="mr-2">üîÑ</span>
                                        )}
                                        Refresh
                                    </button>
                                </div>
                            </div>
                        </div>
                    </header>
                    
                    {/* Main Content */}
                    <main className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
                        {error ? (
                            <ErrorMessage message={error} onRetry={refreshData} />
                        ) : (
                            <div className="space-y-8">
                                {/* Filters */}
                                <FilterPanel
                                    selectedPhone={selectedPhone}
                                    selectedDays={selectedDays}
                                    onPhoneChange={handlePhoneChange}
                                    onDaysChange={handleDaysChange}
                                    activities={activities}
                                />
                                
                                {/* Statistics Overview */}
                                {statistics && (
                                    <StatisticsOverview 
                                        statistics={statistics} 
                                        loading={loading}
                                    />
                                )}
                                
                                {/* Activities List */}
                                <ActivitiesList 
                                    activities={activities} 
                                    loading={loading}
                                />
                            </div>
                        )}
                    </main>
                    
                    {/* Footer */}
                    <footer className="bg-white border-t mt-16">
                        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
                            <div className="text-center text-sm text-gray-500">
                                <p>
                                    ü§ñ Generated with{' '}
                                    <a href="https://claude.ai/code" className="text-indigo-600 hover:underline">
                                        Claude Code
                                    </a>
                                    {' '}‚Ä¢ Send SMS messages to track your activities
                                </p>
                            </div>
                        </div>
                    </footer>
                </div>
            );
        }
        
        /**
         * Error Message Component
         * 
         * Displays error messages with retry functionality.
         */
        function ErrorMessage({ message, onRetry }) {
            return (
                <div className="bg-red-50 border border-red-200 rounded-md p-4">
                    <div className="flex">
                        <div className="flex-shrink-0">
                            <span className="text-red-400 text-xl">‚ö†Ô∏è</span>
                        </div>
                        <div className="ml-3">
                            <h3 className="text-sm font-medium text-red-800">
                                Error Loading Data
                            </h3>
                            <div className="mt-2 text-sm text-red-700">
                                <p>{message}</p>
                            </div>
                            <div className="mt-4">
                                <button
                                    onClick={onRetry}
                                    className="bg-red-100 px-3 py-2 rounded-md text-sm font-medium text-red-800 hover:bg-red-200"
                                >
                                    Try Again
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            );
        }
        
        /**
         * Filter Panel Component
         * 
         * Provides filtering controls for activities data.
         */
        function FilterPanel({ selectedPhone, selectedDays, onPhoneChange, onDaysChange, activities }) {
            // Extract unique phone numbers from activities
            const uniquePhones = [...new Set(activities.map(a => a.phone_number))].sort();
            
            return (
                <div className="bg-white shadow rounded-lg p-6">
                    <h2 className="text-lg font-medium text-gray-900 mb-4">Filters</h2>
                    
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                        {/* Phone Number Filter */}
                        <div>
                            <label htmlFor="phone-filter" className="block text-sm font-medium text-gray-700 mb-2">
                                Phone Number
                            </label>
                            <select
                                id="phone-filter"
                                value={selectedPhone}
                                onChange={(e) => onPhoneChange(e.target.value)}
                                className="block w-full pl-3 pr-10 py-2 text-base border border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md"
                            >
                                <option value="">All Phone Numbers</option>
                                {uniquePhones.map(phone => (
                                    <option key={phone} value={phone}>
                                        {phone}
                                    </option>
                                ))}
                            </select>
                        </div>
                        
                        {/* Days Filter */}
                        <div>
                            <label htmlFor="days-filter" className="block text-sm font-medium text-gray-700 mb-2">
                                Time Period
                            </label>
                            <select
                                id="days-filter"
                                value={selectedDays}
                                onChange={(e) => onDaysChange(e.target.value)}
                                className="block w-full pl-3 pr-10 py-2 text-base border border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md"
                            >
                                <option value="1">Last 24 hours</option>
                                <option value="7">Last 7 days</option>
                                <option value="30">Last 30 days</option>
                                <option value="90">Last 90 days</option>
                                <option value="365">Last year</option>
                            </select>
                        </div>
                    </div>
                </div>
            );
        }
        
        /**
         * Statistics Overview Component
         * 
         * Displays key statistics and metrics in an overview format.
         */
        function StatisticsOverview({ statistics, loading }) {
            if (loading) {
                return (
                    <div className="bg-white shadow rounded-lg p-6">
                        <div className="animate-pulse">
                            <div className="h-4 bg-gray-200 rounded w-1/4 mb-4"></div>
                            <div className="grid grid-cols-1 md:grid-cols-4 gap-4">
                                {[1, 2, 3, 4].map(i => (
                                    <div key={i} className="h-20 bg-gray-200 rounded"></div>
                                ))}
                            </div>
                        </div>
                    </div>
                );
            }
            
            const stats = [
                {
                    name: 'Total Activities',
                    value: statistics.total_activities || 0,
                    icon: 'üìä',
                    color: 'text-blue-600'
                },
                {
                    name: 'Avg Duration',
                    value: statistics.average_duration_minutes ? 
                        `${Math.round(statistics.average_duration_minutes)} min` : 'N/A',
                    icon: '‚è±Ô∏è',
                    color: 'text-green-600'
                },
                {
                    name: 'Unique Locations',
                    value: statistics.unique_locations ? statistics.unique_locations.length : 0,
                    icon: 'üìç',
                    color: 'text-purple-600'
                },
                {
                    name: 'Total Duration',
                    value: statistics.total_duration_minutes ? 
                        `${Math.round(statistics.total_duration_minutes / 60)} hrs` : 'N/A',
                    icon: '‚è∞',
                    color: 'text-indigo-600'
                }
            ];
            
            return (
                <div className="bg-white shadow rounded-lg p-6 fade-in">
                    <h2 className="text-lg font-medium text-gray-900 mb-4">Overview</h2>
                    
                    <div className="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                        {stats.map((stat) => (
                            <div key={stat.name} className="text-center p-4 bg-gray-50 rounded-lg">
                                <div className={`text-2xl ${stat.color} mb-2`}>
                                    {stat.icon}
                                </div>
                                <div className="text-2xl font-semibold text-gray-900">
                                    {stat.value}
                                </div>
                                <div className="text-sm text-gray-500">
                                    {stat.name}
                                </div>
                            </div>
                        ))}
                    </div>
                    
                    {/* Activity Type Breakdown */}
                    {statistics.by_type && Object.keys(statistics.by_type).length > 0 && (
                        <div>
                            <h3 className="text-md font-medium text-gray-900 mb-3">Activity Types</h3>
                            <div className="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-7 gap-2">
                                {Object.entries(statistics.by_type).map(([type, count]) => {
                                    const typeConfig = window.APP_CONFIG.ACTIVITY_TYPES[type] || 
                                        { label: type, icon: 'üìù', color: 'gray' };
                                    return (
                                        <div key={type} className={`activity-${type} rounded-lg p-3 text-center`}>
                                            <div className="text-lg mb-1">{typeConfig.icon}</div>
                                            <div className="font-semibold">{count}</div>
                                            <div className="text-xs capitalize">{typeConfig.label}</div>
                                        </div>
                                    );
                                })}
                            </div>
                        </div>
                    )}
                    
                    {/* Insights */}
                    {statistics.insights && statistics.insights.length > 0 && (
                        <div className="mt-6 p-4 bg-blue-50 rounded-lg">
                            <h3 className="text-md font-medium text-blue-900 mb-2">üí° Insights</h3>
                            <ul className="space-y-1">
                                {statistics.insights.map((insight, index) => (
                                    <li key={index} className="text-sm text-blue-800">
                                        ‚Ä¢ {insight}
                                    </li>
                                ))}
                            </ul>
                        </div>
                    )}
                </div>
            );
        }
        
        /**
         * Activities List Component
         * 
         * Displays a list of activities with details and formatting.
         */
        function ActivitiesList({ activities, loading }) {
            if (loading) {
                return (
                    <div className="bg-white shadow rounded-lg p-6">
                        <div className="animate-pulse">
                            <div className="h-4 bg-gray-200 rounded w-1/4 mb-4"></div>
                            <div className="space-y-3">
                                {[1, 2, 3, 4, 5].map(i => (
                                    <div key={i} className="h-16 bg-gray-200 rounded"></div>
                                ))}
                            </div>
                        </div>
                    </div>
                );
            }
            
            if (activities.length === 0) {
                return (
                    <div className="bg-white shadow rounded-lg p-6 text-center">
                        <div className="text-gray-400 text-6xl mb-4">üì±</div>
                        <h3 className="text-lg font-medium text-gray-900 mb-2">No Activities Found</h3>
                        <p className="text-gray-500">
                            Send an SMS message to start tracking your activities!
                        </p>
                        <div className="mt-4 text-sm text-gray-400">
                            <p>Example: "WORK team meeting for 60 minutes in conference room"</p>
                        </div>
                    </div>
                );
            }
            
            return (
                <div className="bg-white shadow rounded-lg p-6 fade-in">
                    <h2 className="text-lg font-medium text-gray-900 mb-4">
                        Recent Activities ({activities.length})
                    </h2>
                    
                    <div className="space-y-4 max-h-96 overflow-y-auto custom-scrollbar">
                        {activities.map((activity) => (
                            <ActivityCard key={activity.id} activity={activity} />
                        ))}
                    </div>
                </div>
            );
        }
        
        /**
         * Individual Activity Card Component
         * 
         * Displays a single activity with all its details in a card format.
         */
        function ActivityCard({ activity }) {
            const typeConfig = window.APP_CONFIG.ACTIVITY_TYPES[activity.activity_type] || 
                { label: activity.activity_type, icon: 'üìù', color: 'gray' };
            
            const activityDate = new Date(activity.timestamp);
            const isToday = activityDate.toDateString() === new Date().toDateString();
            
            return (
                <div className="border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow">
                    <div className="flex items-start justify-between">
                        <div className="flex items-start space-x-3 flex-1">
                            {/* Activity Type Icon */}
                            <div className={`activity-${activity.activity_type} rounded-lg p-2 flex-shrink-0`}>
                                <span className="text-lg">{typeConfig.icon}</span>
                            </div>
                            
                            {/* Activity Details */}
                            <div className="flex-1 min-w-0">
                                <div className="flex items-center space-x-2 mb-1">
                                    <h4 className="text-sm font-medium text-gray-900 capitalize">
                                        {typeConfig.label}
                                    </h4>
                                    {activity.duration_minutes && (
                                        <span className="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-gray-100 text-gray-800">
                                            {activity.duration_minutes}m
                                        </span>
                                    )}
                                </div>
                                
                                <p className="text-sm text-gray-600 mb-2">
                                    {activity.description}
                                </p>
                                
                                <div className="flex items-center space-x-4 text-xs text-gray-500">
                                    <span>
                                        üïê {isToday ? 
                                            activityDate.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}) :
                                            activityDate.toLocaleDateString() + ' ' + 
                                            activityDate.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})
                                        }
                                    </span>
                                    
                                    {activity.location && (
                                        <span>üìç {activity.location}</span>
                                    )}
                                    
                                    <span>
                                        üì± {activity.phone_number.replace(/(\+1)(\d{3})(\d{3})(\d{4})/, '$1-$2-$3-$4')}
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        }
        
        // Render the main Dashboard component
        ReactDOM.render(<Dashboard />, document.getElementById('root'));
    </script>
</body>
</html>